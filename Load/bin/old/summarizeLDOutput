#!/usr/bin/env python
#pylint: disable=invalid-name

'''
parses and summarizes a PLINK ld output
'''

from __future__ import print_function

import argparse
import csv
import gzip
import numpy

from GenomicsDBData.Util.utils import warning


#data = numpy.random.random(100)
#bins = numpy.linspace(0, 1, 10)
#digitized = numpy.digitize(data, bins)

def summarize():
    upper = [] # >200kb
    lower = [] # <= 200kb
    bins = numpy.arange(0,1.1, 0.1)
    with gzip.open(args.file, 'r') as f:
        reader = csv.DictReader(f, delimiter='\t')
        for row in reader:
            distance = abs(int(row['BP_A']) - int(row['BP_B']))
            
            if distance <= 200:
                lower.append(float(row['R2']))
            else:
                upper.append(float(row['R2']))
            
    lower_hist, lower_bin_edges = numpy.histogram(lower, bins=bins)
    upper_hist, upper_bin_edges = numpy.histogram(upper, bins=bins)

    with open(outputFileName, 'w') as of:
        print("r2", "<=200kb", ">200kb", sep='\t', file=of)
        for i, lc in enumerate(lower_hist):
            print(bins[i], lc, upper_hist[i], sep='\t', file=of)
            


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="summarize ld output file")
    parser.add_argument('-f', '--file', help="full path to sample file", required=True)
 
    args = parser.parse_args()

    outputFileName = args.file.replace('.gz', '-summary.txt')

    

    summarize()
