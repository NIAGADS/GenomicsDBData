#!/usr/bin/env python

""" check to see which consequence the SNPEff LOF consequence matches """
from __future__ import print_function
import sys
import gzip
import csv

filename = sys.argv[1]
targetCsq = sys.argv[2]

# chr     pos     alt     seq_meta_var_id epacts_var_id   gene_symbol     gene    most_damaging_consequence_for_this_gene consequence_impact   most_damaging_consequence_excluding_nmd_transcripts     consequence_impact_excluding_nmd_transcripts    most_damaging_consequence_for_protein_coding_transcripts     consequence_impact_for_protein_coding_transcripts       SNPEff_LOF      SNPEff_LOF_consequence       SNPEff_LOF_num_transcripts_affected     SNPEff_LOF_percent_transcripts_affected

noMatchCount = 0
with gzip.open(filename) as f:
    reader = csv.DictReader(f, delimiter = '\t')
    for row in reader:
        snpEffCsq = row['SNPEff_LOF_consequence']
        csq = row['most_damaging_consequence_for_this_gene']
        noNmdCsq = row['most_damaging_consequence_excluding_nmd_transcripts']
        pcCsq = row['most_damaging_consequence_for_protein_coding_transcripts']

        if targetCsq == 'N':
            if snpEffCsq != noNmdCsq:
                noMatchCount = noMatchCount + 1
                print(row['seq_meta_var_id'], file = sys.stdout)

        if targetCsq == 'P':
            if snpEffCsq !=pcCsq:
                noMatchCount = noMatchCount + 1
                print(row['seq_meta_var_id'], file = sys.stdout)

        if targetCsq == 'T':
            if snpEffCsq != csq:
                noMatchCount = noMatchCount + 1
                print(row['seq_meta_var_id'], file = sys.stdout)

    print("Number non-matches for consequence type " + targetCsq + " = " + str(noMatchCount), file=sys.stderr)


